.masonryGrid {
    display: block; /* switch from grid to CSS columns for true masonry stacking */
    /*
      Responsive columns with a hard cap of 3.
      - Start with 3 columns when space allows.
      - Drop to 2 and then 1 only when space is insufficient.
    */
    --card-min: 340px;            /* minimum width for each column */
    --gap: clamp(1rem, 2vw, 2rem); /* healthy gap to prevent rotated overlap */
    column-count: 3;
    column-gap: var(--gap);
    padding: clamp(0.75rem, 2vw, 1.5rem);
    margin: 0 auto;
    align-items: start;
    /* Enable container query units for smarter scaling on narrow screens */
    container-type: inline-size;

    /* Performance optimization: skip off-screen rendering */
    content-visibility: auto;
    contain-intrinsic-size: 900px; /* prevents layout shift when unseen */
}

.masonryItem {
    display: flex;
    justify-content: center;
    align-items: flex-start; /* Prevent vertical stretching */
    width: 100%;
    /* Vertical spacing between items within each column */
    margin-bottom: var(--gap);
    padding: 0.25rem; /* buffer so rotated items don't touch neighbors */
    break-inside: avoid; /* Prevent items from breaking across columns */
    break-inside: avoid-column; /* Safari/WebKit */
    will-change: transform;
    transform-origin: 50% 0; /* rotate around top center to reduce horizontal overshoot */
    overflow: visible; /* never clip scaled/rotated content */
}

/* Add a slight random rotation to each item for the post-it note feel */
.masonryItem:nth-child(5n+1) { transform: rotate(1.5deg); }
.masonryItem:nth-child(5n+2) { transform: rotate(-1deg); }
.masonryItem:nth-child(5n+3) { transform: rotate(0.5deg); }
.masonryItem:nth-child(5n+4) { transform: rotate(-1.5deg); }
.masonryItem:nth-child(5n+5) { transform: rotate(1deg); }


.embedContainer {
    width: 100%;
    max-width: 540px; /* Constrain to Instagram's max embed width */
    display: flex;
    justify-content: center;
    padding-bottom: 0.2rem; /* consistent bottom space */
    border-radius: 12px;
    overflow: hidden;
    background: linear-gradient(to right, #4f46e5, #f5e882); /* placeholder background */
    box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
    opacity: 0; /* Initially hidden */
    transition: opacity 0.5s ease-in-out; /* Smooth transition */

    /* Ensure card never collapses before lazy content loads */
    min-height: 360px;

    /* Prepare for responsive scaling without layout overflow */
    transform-origin: top center;
}

.embedContainer.loaded {
    opacity: 1; /* Fade in when loaded */
}

.embedContainer > div {
    width: 100%;
    display: flex;
    justify-content: center;
}

/*
  Prevent right-side cropping: IG embed sets a min-width inline.
  Override it so cards can shrink fluidly all the way down to 1 column.
*/
.embedContainer > div > blockquote {
    min-width: 0 !important;
    width: 100% !important;
    max-width: 100% !important;
}

/* Stronger guardrails: ensure all nested elements never overflow horizontally */
.embedContainer,
.embedContainer * {
    max-width: 100% !important;
    box-sizing: border-box;
}

/* Instagram sometimes injects inline min-widths; neutralize them */
.embedContainer [style*="min-width"] {
    min-width: 0 !important;
}

/* Anchor wrapper inside the IG blockquote should not exceed container */
.embedContainer a {
    display: block;
    width: 100% !important;
}

/*
  Drop from 3 columns -> 2 when container can't fit 3 columns at --card-min.
  Approx threshold: 3 * 340px + 2 * gap â‰ˆ ~1100px (incl. padding).
*/
@media (max-width: 1120px) {
    .masonryGrid {
        column-count: 2;
    }
}

/*
  Drop from 2 columns -> 1 when space is tighter than ~720px.
*/
@media (max-width: 760px) {
    .masonryGrid {
        column-count: 1;
        /* minimize side padding so the card gets maximum horizontal room */
        padding-left: clamp(0.25rem, 2vw, 0.5rem);
        padding-right: clamp(0.25rem, 2vw, 0.5rem);
    }
}

/* Ensure Instagram iframes are responsive at all widths */
.embedContainer iframe {
    max-width: 100% !important;
    width: 100% !important;
}

/*
  On ultra-narrow screens, the Instagram iframe enforces an internal min width (~326px).
  We cannot override inside the cross-origin iframe, so scale the container visually
  based on available container width using container query units (cqw).
*/
@supports (width: 1cqw) {
  .embedContainer {
    /* 326px is the smallest IG embed width; compute a safe scale */
    --ig-min: 326;
    --scale: clamp(0.85, calc(100cqw / (var(--ig-min) * 1px)), 1);
    transform: scale(var(--scale));
  }
}

/* Fallback for browsers without container query units: approximate via viewport width */
@supports not (width: 1cqw) {
  @media (max-width: 340px) {
    .embedContainer { transform: scale(calc((100vw - 32px) / 326)); }
  }
}

/*
  Ultra-narrow safety: progressively reduce rotation amplitude and apply a light scale
  so the card fits fully inside the viewport without right-edge cropping.
*/
@media (max-width: 420px) {
    .masonryItem:nth-child(5n+1) { transform: rotate(1deg) scale(0.995); }
    .masonryItem:nth-child(5n+2) { transform: rotate(-0.7deg) scale(0.995); }
    .masonryItem:nth-child(5n+3) { transform: rotate(0.4deg) scale(0.995); }
    .masonryItem:nth-child(5n+4) { transform: rotate(-1deg) scale(0.995); }
    .masonryItem:nth-child(5n+5) { transform: rotate(0.7deg) scale(0.995); }
}

@media (max-width: 360px) {
    .masonryItem:nth-child(5n+1) { transform: rotate(0.8deg) scale(0.985); }
    .masonryItem:nth-child(5n+2) { transform: rotate(-0.6deg) scale(0.985); }
    .masonryItem:nth-child(5n+3) { transform: rotate(0.3deg) scale(0.985); }
    .masonryItem:nth-child(5n+4) { transform: rotate(-0.8deg) scale(0.985); }
    .masonryItem:nth-child(5n+5) { transform: rotate(0.6deg) scale(0.985); }
}

@media (max-width: 320px) {
    .masonryItem:nth-child(5n+1) { transform: rotate(0.6deg) scale(0.965); }
    .masonryItem:nth-child(5n+2) { transform: rotate(-0.5deg) scale(0.965); }
    .masonryItem:nth-child(5n+3) { transform: rotate(0.25deg) scale(0.965); }
    .masonryItem:nth-child(5n+4) { transform: rotate(-0.6deg) scale(0.965); }
    .masonryItem:nth-child(5n+5) { transform: rotate(0.5deg) scale(0.965); }
}
